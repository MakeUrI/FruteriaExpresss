<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fruteria M치rquez - Comprador</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Encabezado -->
    <header class="site-header">
      <div class="header-inner">
        <div class="brand">
          <img src="Imagenes/logo.png" alt="Fruter칤a M치rquez" class="logo">
          <div class="titles">
            <h1>Fruter칤a Express</h1>
            <p class="tagline">Frutas frescas y naturales por mayoreo</p>
          </div>
        </div>

        <nav class="main-nav" aria-label="Navegaci칩n principal">
          <a href="#" class="nav-link" id="inicioLink">Inicio</a>
          <a href="#productos" class="nav-link">Productos</a>
          <a href="administracion.html" class="nav-link">Vendedor</a>
          <a href="carrito.html" class="nav-link nav-carrito">游</a>
          <ul class="login-dropdown" id="loginDropdown" hidden>
            <li><button class="nav-link" id="abrirLogin">Iniciar sesi칩n</button></li>
          </ul>
        </nav>
      </div>
    </header>
  
    <!-- Contenido Principal -->
    <main>
      <!-- Bot칩n para ver el carrito -->
      <div class="boton-carrito-fijo">
        <button class="boton-carrito" onclick="window.location.href='carrito.html'">
          游 Ver Carrito
        </button>
      </div>
  
      <!-- Contenedor de productos -->
      <div class="contenedor-productos" id="productos">
        <h2 style="font-size:1.25rem;font-weight:600;margin-bottom:1rem;text-align: center;">Productos disponibles</h2>
  
        <!-- Lista de productos -->
        <div class="lista-productos"> 
          <!-- Producto: Pl치tanos -->
          <div class="tarjeta-producto" data-nombre="Pl치tanos">
            <img src="Imagenes/banane-large.jpg" alt="Pl치tanos"> 
            <h3>Pl치tanos</h3>
            <p>$<span id="precio_platanos" data-key="platanos">60</span> kg</p>
            <input type="number" id="cantidad_platanos" data-key="platanos" min="1" value="1">
            <button class="boton-comprar" onclick="a침adirAlCarrito('platanos')">
              Comprar
            </button>
          </div>

          <!-- Producto: Manzanas -->
          <div class="tarjeta-producto" data-nombre="Manzanas">
            <img src="Imagenes/manzanas.jpeg" alt="Manzanas"> 
            <h3>Manzanas</h3>
            <p>$<span id="precio_manzanas" data-key="manzanas">14.99</span> kg</p> <!-- Added 'kg' -->
            <input type="number" id="cantidad_manzanas" data-key="manzanas" min="1" value="1">
            <button class="boton-comprar" onclick="a침adirAlCarrito('manzanas')">
              Comprar
            </button>
          </div>

          <!-- Producto: Peras -->
          <div class="tarjeta-producto" data-nombre="Peras">
            <img src="Imagenes/Pera_3.jpg" alt="Peras"> 
            <h3>Peras</h3>
            <p>$<span id="precio_peras" data-key="peras">12.99</span></p>
            <input type="number" id="cantidad_peras" data-key="peras" min="1" value="1">
            <button class="boton-comprar" onclick="a침adirAlCarrito('peras')">
              Comprar
            </button>
          </div>

          <!-- Producto: Sand칤as -->
          <div class="tarjeta-producto" data-nombre="Sand칤as">
            <img src="Imagenes/sandia.jpg" alt="Sand칤as">
            <h3>Sand칤as</h3>
            <p>$<span id="precio_sandias" data-key="sandias">30</span> kg</p>
            <input type="number" id="cantidad_sandias" data-key="sandias" min="1" value="1">
            <button class="boton-comprar" onclick="a침adirAlCarrito('sandias')">
              Comprar
            </button>
          </div>

          <!--producto guayaba-->
          <div class="tarjeta-producto" data-nombre="guayaba">
            <img src="Imagenes/guayabas.jpeg" alt="guayabas">
            <h3>guayaba</h3>
            <p>$ <span id="precio_guayaba" data-key="guayaba" min="1" value="1">50</span></p>
            <input type="number" id="cantidad_guayaba" data-key="guayaba" min="1" value="1">
            <button class="boton-comprar" onclick="a침adirAlCarrito('guayaba')">
              Comprar
            </button>
          </div>

          <!--producto melon-->
          <div class="tarjeta-producto" data-nombre="melon">
            <img src="Imagenes/melon.jpg" alt="melon">
            <h3>melon</h3>
            <p>$ <span id="precio_melon" data-key="melon" min="1" value="1">25</span></p>
            <input type="number" id="cantidad_melon" data-key="melon" min="1" value="1">
            <button class="boton-comprar" onclick="a침adirAlCarrito('melon')">
              Comprar
            </button>
          </div>

          <!--producto pi침a-->
          <div class="tarjeta-producto" data-nombre="pi침a">
            <img src="Imagenes/pi침a.jpg" alt="pi침a">
            <h3>pi침a</h3>
            <p>$ <span id="precio_pi침a" data-key="pi침a" min="1" value="1">45</span></p>
            <input type="number" id="cantidad_pi침a" data-key="pi침a" min="1" value="1">
            <button class="boton-comprar" onclick="a침adirAlCarrito('pi침a')">
              Comprar
            </button>
        </div> <!-- Fin lista de productos -->
  
        <!-- Bot칩n para ir a la p치gina del vendedor -->
        <div style="text-align:center;margin-top:1.5rem;">
          <button class="boton-vendedor" onclick="window.location.href='administracion.html'">
            P치gina del Vendedor
          </button>
        </div>
  
      </div> <!-- Fin contenedor de productos -->
    </main>
  
    <!-- Pie de P치gina -->
    <footer>
      <p>Derechos Reservados &copy; 2025</p>
    </footer>

    <!-- Notificaci칩n -->
    <div id="aviso" class="oculto" role="status" aria-live="polite">
      Producto a침adido al carrito.
    </div>

    <div class="modal-overlay oculto" id="loginModal" aria-hidden="true">
      <div class="modal">
        <h3>Iniciar sesi칩n</h3>
        <form id="formLogin">
          <label for="nombreLogin">Nombre</label>
          <input type="text" id="nombreLogin" name="nombre" required>
          <label for="correoLogin">Correo (opcional)</label>
          <input type="email" id="correoLogin" name="correo">
          <label for="passLogin">Contrase침a</label>
          <input type="password" id="passLogin" name="password" required>
          <div style="display:flex;gap:0.5rem;margin-top:0.75rem;justify-content:flex-end">
            <button type="button" class="boton-volver" id="cancelLogin">Cancelar</button>
            <button type="submit" class="boton-comprar">Entrar</button>
          </div>
          <p id="loginMensaje" style="color:#ef4444;margin:0.5rem 0 0 0;display:none"></p>
        </form>
      </div>
    </div>

  </body>

  <script>
    // Cargar precios guardados en localStorage al inicio
    function cargarPreciosDesdeStorage() {
      document.querySelectorAll('[data-key]').forEach(el => {
        // solo interesa el span que muestra el precio (no inputs de cantidad)
        if (el.tagName.toLowerCase() === 'span') {
          const key = el.getAttribute('data-key');
          const valor = localStorage.getItem(`precio_${key}`);
          if (valor !== null) {
            el.innerText = parseFloat(valor);
          }
        }
      });
    }

    function a침adirAlCarrito(key) {
      // obtener precio y cantidad usando data-key
      let precio = getPrecio(key);
      let cantidad = getCantidad(key);

      let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
  
      // Verificar si el producto ya existe en el carrito
      let productoExistente = carrito.find(item => item.key === key);
      
      if (productoExistente) {
        productoExistente.cantidad += cantidad; // Sumar cantidad si ya existe
      } else {
        carrito.push({ key, precio, cantidad });
      }
  
      localStorage.setItem('carrito', JSON.stringify(carrito));

      // Mostrar la notificaci칩n
      mostrarNotificacion(`${cantidad} ${key}(s) agregado(s) al carrito.`);
    }

    // variable para controlar el timeout y evitar superposiciones
    let avisoTimeout = null;

    function mostrarNotificacion(mensaje) {
      const aviso = document.getElementById('aviso');
      // texto din치mico
      aviso.innerText = mensaje;

      // limpiar timeout anterior si existe
      if (avisoTimeout) {
        clearTimeout(avisoTimeout);
        avisoTimeout = null;
      }

      // mostrar aviso (quita la clase oculto)
      aviso.classList.remove('oculto');

      // ocultar la notificaci칩n despu칠s de 3 segundos
      avisoTimeout = setTimeout(() => {
        aviso.classList.add('oculto');
        avisoTimeout = null;
      }, 3000); // 3000 ms = 3 segundos
    }
  
    function getPrecio(key) {
      const el = document.querySelector(`[data-key="${key}"]`);
      // si el span existe y tiene texto, usarlo; si hay precio en storage, usar storage
      const almacen = localStorage.getItem(`precio_${key}`);
      if (almacen !== null) return parseFloat(almacen);
      return parseFloat(el ? el.innerText : '0');
    }
  
    function getCantidad(key) {
      const el = document.querySelector(`input[data-key="${key}"]`);
      return parseInt(el ? el.value : '1') || 1;
    }

    // Ejecutar carga al abrir la p치gina
    window.addEventListener('DOMContentLoaded', function(){
      cargarPreciosDesdeStorage();
      const usuariosPermitidos = ['uriel','marisol','estrella','ivan','pruebas'];
      const inicioLink = document.getElementById('inicioLink');
      const loginDropdown = document.getElementById('loginDropdown');
      const abrirLogin = document.getElementById('abrirLogin');
      const loginModal = document.getElementById('loginModal');
      const cancelLogin = document.getElementById('cancelLogin');
      const formLogin = document.getElementById('formLogin');
      const loginMensaje = document.getElementById('loginMensaje');
      if (inicioLink) {
        inicioLink.addEventListener('click', (ev)=>{
          ev.preventDefault();
          if (!loginDropdown) return;
          loginDropdown.hidden = !loginDropdown.hidden;
        });
      }
      if (abrirLogin) {
        abrirLogin.addEventListener('click', ()=>{
          if (loginDropdown) loginDropdown.hidden = true;
          if (loginModal) { loginModal.classList.remove('oculto'); loginModal.setAttribute('aria-hidden','false'); }
        });
      }
      if (cancelLogin) {
        cancelLogin.addEventListener('click', ()=>{
          if (loginModal) { loginModal.classList.add('oculto'); loginModal.setAttribute('aria-hidden','true'); }
          if (loginMensaje) loginMensaje.style.display = 'none';
          if (formLogin) formLogin.reset();
        });
      }
      if (formLogin) {
        formLogin.addEventListener('submit', (e)=>{
          e.preventDefault();
          const nombre = (document.getElementById('nombreLogin').value || '').trim().toLowerCase();
          const pass = document.getElementById('passLogin').value || '';
          if (!usuariosPermitidos.includes(nombre)) { loginMensaje.textContent = 'Usuario no reconocido'; loginMensaje.style.display = 'block'; return; }
          if (!pass) { loginMensaje.textContent = 'Contrase침a requerida'; loginMensaje.style.display = 'block'; return; }
          loginMensaje.style.display = 'none';
          if (loginModal) { loginModal.classList.add('oculto'); loginModal.setAttribute('aria-hidden','true'); }
          mostrarNotificacion('Inicio de sesi칩n correcto: ' + nombre);
          formLogin.reset();
        });
      }
    });
  </script>
</html>
